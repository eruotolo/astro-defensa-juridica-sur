---
// Componente de formulario de contacto
---

<div class="container mx-auto px-6 sm:px-8 md:px-10 xl:px-0 pb-12">
    <div class="flex flex-col justify-center items-center mb-8 sm:mb-10 md:mb-[40px]">
        <h2 class="tituloH1" data-aos="fade-down" data-aos-duration="800">Contáctanos</h2>
        <p
            class="textAlternative py-[15px] text-center px-4 sm:px-0 md:w-[70%]"
            data-aos="fade-up"
            data-aos-duration="900"
        >
            Completa el formulario y nos pondremos en contacto a la brevedad para atender tu
            consulta legal.
        </p>
    </div>

    <!-- Grid de 12 columnas -->
    <div class="grid grid-cols-12">
        <form
            id="contactForm"
            class="col-span-12 md:col-span-10 md:col-start-2"
            data-aos="fade-up"
            data-aos-duration="1000"
        >
            <!-- Fila 1: Nombre, Email, Teléfono -->
            <div
                class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 sm:gap-5 md:gap-6 mb-4 sm:mb-5 md:mb-6"
            >
                <div class="form-field">
                    <label for="name" class="sr-only">Nombre completo</label>
                    <input
                        type="text"
                        name="name"
                        id="name"
                        placeholder="Nombre*"
                        class="w-full px-4 py-4 md:py-3 min-h-[48px] md:min-h-[44px] border border-gris-border rounded-sm focus:outline-none focus:border-marron focus:ring-2 focus:ring-marron focus:ring-offset-2 transition-all duration-200 text-base sm:text-sm placeholder:text-[#767676]"
                        required
                    />
                </div>
                <div class="form-field">
                    <label for="email" class="sr-only">Correo electrónico</label>
                    <input
                        type="email"
                        name="email"
                        id="email"
                        placeholder="Email*"
                        class="w-full px-4 py-4 md:py-3 min-h-[48px] md:min-h-[44px] border border-gris-border rounded-sm focus:outline-none focus:border-marron focus:ring-2 focus:ring-marron focus:ring-offset-2 transition-all duration-200 text-base sm:text-sm placeholder:text-[#767676]"
                        required
                    />
                </div>
                <div class="form-field md:col-span-2 lg:col-span-1">
                    <label for="phone" class="sr-only">Número de teléfono</label>
                    <input
                        type="tel"
                        name="phone"
                        id="phone"
                        placeholder="Teléfono*"
                        class="w-full px-4 py-4 md:py-3 min-h-[48px] md:min-h-[44px] border border-gris-border rounded-sm focus:outline-none focus:border-marron focus:ring-2 focus:ring-marron focus:ring-offset-2 transition-all duration-200 text-base sm:text-sm placeholder:text-[#767676]"
                        required
                    />
                </div>
            </div>

            <!-- Fila 1.5: Asunto -->
            <div class="form-field mb-4 sm:mb-5 md:mb-6">
                <label for="subject" class="sr-only">Asunto de consulta</label>
                <select
                    name="subject"
                    id="subject"
                    class="w-full px-4 py-4 md:py-3 min-h-[48px] md:min-h-[44px] border border-gris-border rounded-sm focus:outline-none focus:border-marron focus:ring-2 focus:ring-marron focus:ring-offset-2 transition-all duration-200 text-base sm:text-sm text-[#767676]"
                    required
                >
                    <option value="" disabled selected>Asunto de consulta*</option>
                    <option value="Busco un abogado">¿Buscas un abogado?</option>
                    <option value="Evaluación de caso">¿Deseas una evaluación de caso?</option>
                    <option value="Agendar reunión"
                        >¿Deseas agendar una reunión y aclarar tus dudas jurídicas?</option
                    >
                    <option value="Otro">Otro</option>
                </select>
            </div>

            <!-- Fila 2: Mensaje -->
            <div class="form-field mb-4 sm:mb-5 md:mb-6">
                <label for="message" class="sr-only">Mensaje de consulta</label>
                <textarea
                    name="message"
                    id="message"
                    rows="7"
                    placeholder="Mensaje*"
                    class="w-full px-4 py-4 md:py-3 border border-gris-border rounded-sm focus:outline-none focus:border-marron focus:ring-2 focus:ring-marron focus:ring-offset-2 transition-all duration-200 resize-none text-base sm:text-sm placeholder:text-[#767676]"
                    required></textarea>
            </div>

            <!-- Fila 3: Botón centrado -->
            <div class="flex justify-center">
                <button
                    type="submit"
                    id="submitBtn"
                    class="w-full sm:w-auto bg-marron text-white px-8 py-4 md:py-3 min-h-[48px] md:min-h-[44px] rounded-[3px] font-sans font-normal tracking-wider hover:bg-secondary active:scale-95 transition-all duration-300 disabled:opacity-50 disabled:cursor-not-allowed text-[14px] uppercase cursor-pointer"
                >
                    <span id="buttonText">Enviar Mensaje</span>
                    <span id="buttonLoader" class="hidden">Enviando...</span>
                </button>
            </div>

            <!-- Mensaje de respuesta -->
            <div
                id="formMessage"
                role="alert"
                aria-live="polite"
                class="mt-6 p-4 rounded-sm text-center hidden transition-all duration-300"
            >
            </div>
        </form>
    </div>
</div>

<script>
    const form = document.getElementById("contactForm") as HTMLFormElement;
    const submitBtn = document.getElementById("submitBtn") as HTMLButtonElement;
    const buttonText = document.getElementById("buttonText") as HTMLSpanElement;
    const buttonLoader = document.getElementById("buttonLoader") as HTMLSpanElement;
    const formMessage = document.getElementById("formMessage") as HTMLDivElement;

    form?.addEventListener("submit", async (e) => {
        e.preventDefault();

        // Deshabilitar botón y mostrar loader
        submitBtn.disabled = true;
        buttonText.classList.add("hidden");
        buttonLoader.classList.remove("hidden");
        formMessage.classList.add("hidden");

        // Obtener datos del formulario
        const formData = new FormData(form);

        try {
            // Enviar datos a la API
            const response = await fetch("/api/contact", {
                method: "POST",
                body: formData,
            });

            const data = await response.json();

            // Mostrar mensaje de respuesta
            formMessage.textContent = data.message;
            formMessage.classList.remove("hidden");

            if (data.success) {
                // Éxito: mensaje verde
                formMessage.classList.remove("bg-red-100", "text-red-700", "border-red-400");
                formMessage.classList.add(
                    "bg-green-100",
                    "text-green-700",
                    "border",
                    "border-green-400",
                );

                // Limpiar formulario
                form.reset();
            } else {
                // Error: mensaje rojo
                formMessage.classList.remove("bg-green-100", "text-green-700", "border-green-400");
                formMessage.classList.add("bg-red-100", "text-red-700", "border", "border-red-400");
            }
        } catch (error) {
            // Error de red o servidor
            formMessage.textContent = "Error al enviar el mensaje. Por favor intente nuevamente.";
            formMessage.classList.remove(
                "hidden",
                "bg-green-100",
                "text-green-700",
                "border-green-400",
            );
            formMessage.classList.add("bg-red-100", "text-red-700", "border", "border-red-400");
        } finally {
            // Restaurar botón
            submitBtn.disabled = false;
            buttonText.classList.remove("hidden");
            buttonLoader.classList.add("hidden");

            // Ocultar mensaje después de 5 segundos
            setTimeout(() => {
                formMessage.classList.add("hidden");
            }, 5000);
        }
    });
</script>
