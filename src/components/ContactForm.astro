---
// Componente de formulario de contacto
---

<div class="container mx-auto">
    <div class="flex flex-col justify-center items-center mb-[40px]">
        <h1 class="tituloH1">Contáctanos</h1>
        <p class="parrafo py-[15px] text-center md:w-[60%]">
            Completa el formulario y nos pondremos en contacto contigo a la brevedad para atender tu
            consulta legal.
        </p>
    </div>

    <!-- Grid de 12 columnas -->
    <div class="grid grid-cols-12">
        <form id="contactForm" class="col-span-12 md:col-span-10 md:col-start-2">
            <!-- Fila 1: Nombre, Email, Teléfono -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-6">
                <div class="form-field">
                    <input
                        type="text"
                        name="name"
                        id="name"
                        placeholder="Nombre*"
                        class="w-full px-4 py-3 border border-gris-border rounded-sm focus:outline-none focus:border-marron transition-colors duration-200 text-[#aaaaaa] text-[14px]"
                        required
                    />
                </div>
                <div class="form-field">
                    <input
                        type="email"
                        name="email"
                        id="email"
                        placeholder="Email*"
                        class="w-full px-4 py-3 border border-gris-border rounded-sm focus:outline-none focus:border-marron transition-colors duration-200 text-[#aaaaaa] text-[14px]"
                        required
                    />
                </div>
                <div class="form-field">
                    <input
                        type="tel"
                        name="phone"
                        id="phone"
                        placeholder="Teléfono*"
                        class="w-full px-4 py-3 border border-gris-border rounded-sm focus:outline-none focus:border-marron transition-colors duration-200 text-[#aaaaaa] text-[14px]"
                        required
                    />
                </div>
            </div>

            <!-- Fila 2: Mensaje -->
            <div class="form-field mb-6">
                <textarea
                    name="message"
                    id="message"
                    rows="7"
                    placeholder="Mensaje*"
                    class="w-full px-4 py-3 border border-gris-border rounded-sm focus:outline-none focus:border-marron transition-colors duration-200 resize-none text-[#aaaaaa] text-[14px]"
                    required></textarea>
            </div>

            <!-- Fila 3: Botón centrado -->
            <div class="flex justify-center">
                <button
                    type="submit"
                    id="submitBtn"
                    class="bg-marron text-white px-8 py-3 rounded-[3px] font-sans font-normal tracking-wider hover:bg-secondary transition-colors duration-300 disabled:opacity-50 disabled:cursor-not-allowed text-[14px] uppercase cursor-pointer"
                >
                    <span id="buttonText">Enviar Mensaje</span>
                    <span id="buttonLoader" class="hidden">Enviando...</span>
                </button>
            </div>

            <!-- Mensaje de respuesta -->
            <div
                id="formMessage"
                class="mt-6 p-4 rounded-sm text-center hidden transition-all duration-300"
            >
            </div>
        </form>
    </div>
</div>

<script>
    const form = document.getElementById("contactForm") as HTMLFormElement;
    const submitBtn = document.getElementById("submitBtn") as HTMLButtonElement;
    const buttonText = document.getElementById("buttonText") as HTMLSpanElement;
    const buttonLoader = document.getElementById("buttonLoader") as HTMLSpanElement;
    const formMessage = document.getElementById("formMessage") as HTMLDivElement;

    form?.addEventListener("submit", async (e) => {
        e.preventDefault();

        // Deshabilitar botón y mostrar loader
        submitBtn.disabled = true;
        buttonText.classList.add("hidden");
        buttonLoader.classList.remove("hidden");
        formMessage.classList.add("hidden");

        // Obtener datos del formulario
        const formData = new FormData(form);

        try {
            // Enviar datos a la API
            const response = await fetch("/api/contact", {
                method: "POST",
                body: formData,
            });

            const data = await response.json();

            // Mostrar mensaje de respuesta
            formMessage.textContent = data.message;
            formMessage.classList.remove("hidden");

            if (data.success) {
                // Éxito: mensaje verde
                formMessage.classList.remove("bg-red-100", "text-red-700", "border-red-400");
                formMessage.classList.add(
                    "bg-green-100",
                    "text-green-700",
                    "border",
                    "border-green-400",
                );

                // Limpiar formulario
                form.reset();
            } else {
                // Error: mensaje rojo
                formMessage.classList.remove("bg-green-100", "text-green-700", "border-green-400");
                formMessage.classList.add("bg-red-100", "text-red-700", "border", "border-red-400");
            }
        } catch (error) {
            // Error de red o servidor
            formMessage.textContent = "Error al enviar el mensaje. Por favor intente nuevamente.";
            formMessage.classList.remove(
                "hidden",
                "bg-green-100",
                "text-green-700",
                "border-green-400",
            );
            formMessage.classList.add("bg-red-100", "text-red-700", "border", "border-red-400");
        } finally {
            // Restaurar botón
            submitBtn.disabled = false;
            buttonText.classList.remove("hidden");
            buttonLoader.classList.add("hidden");

            // Ocultar mensaje después de 5 segundos
            setTimeout(() => {
                formMessage.classList.add("hidden");
            }, 5000);
        }
    });
</script>
